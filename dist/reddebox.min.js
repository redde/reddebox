/*! Reddebox - v0.1.0 - 2013-06-20
* http://gitlab.redde.ru/reddebox
* Copyright (c) 2013 Konstantin Gorozhankin; Licensed MIT */
(function(){(function(e){e.fn.reddebox=function(t){var i;return i=this,this.off("click.reddebox").on("click.reddebox",function(n){new e.reddebox(this,i,t),n.preventDefault()})},e.reddebox=function(t,i,n){var s,r;return r={overlayOpacity:.5,classWrapper:"",useThisLink:!0,clickSubstrate:!1,imageArray:[],activeIndex:0},e.extend(r,n),s=e.map(r.imageArray,function(t){return e("<a />").attr("href",t).get(0)}),this.jQueryMatchedObj=e.merge(e.merge([],i),s),r.useThisLink||(this.jQueryMatchedObj=e.grep(this.jQueryMatchedObj,function(e){return t!==e})),this.maxLength=this.jQueryMatchedObj.length,this.settings=r,this.setInterface(t),this},e.reddebox.prototype={_setActiveIndex:function(t){return this.activeIndex=e.isFunction(this.settings.activeIndex)?this.settings.activeIndex.call():e.map(this.jQueryMatchedObj,function(e,i){return e===t?i:void 0})[0]||0},remove:function(){e("#redde-overlay, #redde-box").remove()},vis:function(e){return e.css("visibility","visible")},hid:function(e){return e.css("visibility","hidden")},updateNavi:function(){return this.vis(this.container.find("i.redde-next, i.redde-prev")),0===this.activeIndex&&this.hid(e("i.redde-prev")),this.activeIndex===this.maxLength-1&&this.hid(e("i.redde-next")),this._setTitle()},_setTitle:function(){var e;(e=this.jQueryMatchedObj[this.activeIndex].title)?this.vis(this.container.find("div.redde-desc").html(e)):this.hid(this.container.find("div.redde-desc").empty())},showImage:function(){var t,i,n;n=this,this.updateNavi(),t=e(this.jQueryMatchedObj[this.activeIndex]).attr("href"),/\.(jpg|jpeg|gif|png)$/i.test(t)?(i=new Image,i.onload=function(){n._printElLoad(e(this).fadeTo(0,0).get(0))},i.src=t):this._printElLoad("<iframe src='"+t+"' frameborder='0' />")},_printElLoad:function(e){this.printEl=e,this.setCenter()},setCenter:function(){var t,i,n;return t=e(this.printEl).appendTo(this.container.find("#wrap-redde-container").empty()),n=t.width(),i=t.height(),this.container.addClass("resize-show-photo").stop(!1,!1).animate({width:n,height:i,"margin-left":-n/2-1,"margin-top":-i/2-1,top:"50%",left:"50%"},400,function(){e(this).removeClass("resize-show-photo"),e.isFunction(e.fn.draggable)&&e(this).draggable({stop:function(){var t,s,r,d,a,o;t={},s=parseInt(e(this).css("left"),10),a=parseInt(e(this).css("top"),10),d=e(this).offsetParent(),r=parseInt(d.width(),10),o=parseInt(d.height(),10),r>n?0>s?t.left=0:s>r&&(t.left=r):r/2-s>n/2?t.left=(r-n)/2:s-r/2>n/2&&(t.left=(r+n)/2),o>i?0>a?t.top=0:a>o&&(t.top=o):o/2-a>i/2?t.top=(o-i)/2:a-o/2>i/2&&(t.top=(o+i)/2),e(this).animate(t)}})}).find("img").fadeTo(0,1)},_cssClassWrapper:function(){return this.settings.classWrapper?" class='"+this.settings.classWrapper+"'":""},setInterface:function(t){var i,n,s;this._setActiveIndex(t),n='<div id="redde-overlay"></div>\n<div id="redde-box"'+this._cssClassWrapper()+'>\n  <div id="redde-container">\n    <div id="wrap-redde-container"></div>\n    <i class="redde-prev"></i>\n    <i class="redde-close"></i>\n    <i class="redde-next"></i> \n    <div class="redde-desc"></div>\n  </div>\n</div>',i=e(n).appendTo("body"),this.container=i.find("#redde-container").on("click",function(e){return e.stopPropagation()}),i.filter("#redde-overlay").fadeTo(400,this.settings.overlayOpacity),s=this,i.filter("#redde-box").fadeTo(400,1,function(){s.settings.clickSubstrate&&e(this).click(s.remove)}),this.showImage(),this.container.find("i").click(function(t){e(this).hasClass("redde-next")?(s.container.stop(!0,!0),++s.activeIndex,s.showImage()):e(this).hasClass("redde-prev")?(s.container.stop(!0,!0),--s.activeIndex,s.showImage()):e(this).hasClass("redde-close")&&s.remove(),t.stopPropagation()})}}})(jQuery)}).call(this);
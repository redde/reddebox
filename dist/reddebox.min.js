/*! Reddebox - v0.1.0 - 2013-06-11
* http://gitlab.redde.ru/reddebox
* Copyright (c) 2013 Konstantin Gorozhankin; Licensed MIT */
(function(){(function(e){e.fn.reddebox=function(){var t,i;return i=e.extend({overlayOpacity:.5,classWrapper:"",fWidth:640,fHeight:480,useThisLink:!0,imageArray:[],activeImage:0},i),t=this,this.off("click.reddebox").on("click.reddebox",function(s){new e.reddebox(this,t,i),s.preventDefault()})},e.reddebox=function(t,i,s){var n;return n=e.map(s.activeImage,function(t){return e("<a />").attr("href",t)[0]}),this.jQueryMatchedObj=s.useThisLink?e.merge(e.merge([],i),n):n,this.activeIndex=e.map(i,function(e,i){return e===t?i:void 0})[0]||0,this.settings=s,this.setInterface(t),this},e.reddebox.prototype={removeReddeBox:function(){e("#redde-overlay, #redde-box").remove()},setActiveIndex:function(e){var t;for(t=this.jQueryMatchedObj.length;t--;)if(this.jQueryMatchedObj[t].href===e){this.activeIndex=t;break}},updateNavi:function(t){var i;i=this.jQueryMatchedObj.length,this.setActiveIndex(t.attr("href")),this.container.find("a.redde-next, a.redde-prev").css("visibility","visible"),0===this.activeIndex&&e("a.redde-prev").css("visibility","hidden"),this.activeIndex===i-1&&e("a.redde-next").css("visibility","hidden"),t.attr("title")?this.container.find("div.redde-desc").html(t.attr("title")).css("visibility","visible"):this.container.find("div.redde-desc").empty().css("visibility","hidden")},showImage:function(t){var i,s;s=this,this.updateNavi(t),/\.(jpg|jpeg|gif|png)$/i.test(e(t).attr("href"))?(i=new Image,i.onload=function(){s._printElLoad(e(this).fadeTo(0,0).get(0))},i.src=t.attr("href")):this._printElLoad("<iframe src='"+t.attr("href")+"' frameborder='0' width='"+this.settings.fWidth+"' height='"+this.settings.fHeight+"' />")},_printElLoad:function(e){this.printEl=e,this.setCenter()},setCenter:function(){var t,i,s;return t=e(this.printEl).appendTo(this.container.find("#wrap-redde-container").empty()),s=t.width(),i=t.height(),this.container.addClass("resize-show-photo").stop(!1,!1).animate({width:s,height:i,"margin-left":-s/2-1,"margin-top":-i/2-1,top:"50%",left:"50%"},400,function(){e(this).removeClass("resize-show-photo"),e.isFunction(e.fn.draggable)&&e(this).draggable({stop:function(){var t,n,r,a,d,h;t={},n=parseInt(e(this).css("left"),10),d=parseInt(e(this).css("top"),10),a=e(this).offsetParent(),r=parseInt(a.width(),10),h=parseInt(a.height(),10),r>s?0>n?t.left=0:n>r&&(t.left=r):r/2-n>s/2?t.left=(r-s)/2:n-r/2>s/2&&(t.left=(r+s)/2),h>i?0>d?t.top=0:d>h&&(t.top=h):h/2-d>i/2?t.top=(h-i)/2:d-h/2>i/2&&(t.top=(h+i)/2),e(this).animate(t)}})}).find("img").fadeTo(0,1)},setInterface:function(t){var i,s,n;s=this.settings.classWrapper?" class='"+this.settings.classWrapper+"'":"",i='<div id="redde-overlay"></div>\n<div id="redde-box" '+s+'>\n  <div id="redde-container">\n    <div id="wrap-redde-container"></div>\n    <a href="#" class="redde-prev"></a>\n    <a href="#" class="redde-close"></a>\n    <a href="#" class="redde-next"></a> \n    <div class="redde-desc"></div>\n  </div>\n</div>',e("body").append(i),this.container=e("#redde-container"),e("#redde-overlay").fadeTo(400,this.settings.overlayOpacity),n=this,e("#redde-box").fadeTo(400,1,function(){e(this).bind("click",function(e){e.target===this&&n.removeReddeBox()})}),this.settings.imageArray.length?(this.settings.activeImage&&(this.activeIndex=this.settings.activeImage),this.showImage(e(this.jQueryMatchedObj[this.activeIndex]))):this.showImage(e(t)),this.container.find("a").click(function(t){var i;switch(this.className){case"redde-next":case"redde-prev":n.container.stop(!0,!0),i="redde-prev"===this.className?-1:1,void 0!==n.jQueryMatchedObj[n.activeIndex+i]&&(n.activeIndex=n.activeIndex+i,n.showImage(e(n.jQueryMatchedObj[n.activeIndex])));break;case"redde-close":n.removeReddeBox()}t.preventDefault()})}}})(jQuery)}).call(this);
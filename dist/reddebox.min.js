/*! Reddebox - v0.1.0 - 2013-04-11
* http://gitlab.redde.ru/reddebox
* Copyright (c) 2013 Konstantin Gorozhankin; Licensed MIT */
(function(e){e.fn.reddebox=function(t){t=jQuery.extend({overlayOpacity:.5,classWrapper:"",useThisLink:!0,imageArray:[],activeImage:0},t);var i=this;return this.off("click.reddebox").on("click.reddebox",function(r){new e.reddebox(this,i,t),r.preventDefault()})},e.reddebox=function(t,i,r){var a=e.map(r.imageArray,function(t){return e("<a />").attr("href",t)[0]});this.jQueryMatchedObj=r.useThisLink?e.merge(e.merge([],i),a):a,this.activeIndex=e.map(i,function(e,i){return e===t?i:void 0})[0]||0,this.setInterface(t,r)},e.reddebox.prototype={removeReddeBox:function(){e("#redde-overlay, #redde-box").remove()},setActiveIndex:function(e){for(var t=this.jQueryMatchedObj.length;t--;)if(this.jQueryMatchedObj[t].href===e){this.activeIndex=t;break}},updateNavi:function(t){var i=this.jQueryMatchedObj.length;this.setActiveIndex(t.attr("href")),this.container.find("a.redde-next, a.redde-prev").css("visibility","visible"),0===this.activeIndex&&e("a.redde-prev").css("visibility","hidden"),this.activeIndex===i-1&&e("a.redde-next").css("visibility","hidden"),t.attr("title")?this.container.find("div.redde-desc").html(t.attr("title")).css("visibility","visible"):this.container.find("div.redde-desc").empty().css("visibility","hidden")},showImage:function(t){var i=this;this.updateNavi(t),/\.(jpg|jpeg|gif|png)$/i.test(e(t).attr("href"))?e("<img />").attr("src",t.attr("href")).fadeTo(0,0).load(function(){i._printElLoad(this)}):this._printElLoad('<iframe src="'+t.attr("href")+'" frameborder="0" width="640" height="480" />')},_printElLoad:function(e){this.printEl=e,this.setCenter()},setCenter:function(){var t=e(this.printEl).appendTo(this.container.find("#wrap-redde-container").empty()),i=t.width(),r=t.height();this.container.addClass("resize-show-photo").stop(!1,!1).animate({width:i,height:r,"margin-left":-i/2-1,"margin-top":-r/2-1,top:"50%",left:"50%"},400,function(){e(this).removeClass("resize-show-photo"),e.isFunction(e.fn.draggable)&&e(this).draggable({stop:function(){var t={},a=parseInt(e(this).css("left"),10),d=parseInt(e(this).css("top"),10),s=e(this).offsetParent(),n=parseInt(s.width(),10),o=parseInt(s.height(),10);n>i?0>a?t.left=0:a>n&&(t.left=n):n/2-a>i/2?t.left=(n-i)/2:a-n/2>i/2&&(t.left=(n+i)/2),o>r?0>d?t.top=0:d>o&&(t.top=o):o/2-d>r/2?t.top=(o-r)/2:d-o/2>r/2&&(t.top=(o+r)/2),e(this).animate(t)}})}).find("img").fadeTo(0,1)},setInterface:function(t,i){var r=i.classWrapper?' class="'+i.classWrapper+'"':"",a='<a href="#" class="redde-prev"></a><a href="#" class="redde-close"></a><a href="#" class="redde-next"></a><div class="redde-desc"></div>',d='<div id="redde-overlay"></div><div id="redde-box"'+r+">"+'<div id="redde-container"><div id="wrap-redde-container"></div>'+a+"</div>"+"</div>";e("body").append(d),this.container=e("#redde-container"),e("#redde-overlay").fadeTo(400,i.overlayOpacity);var s=this;e("#redde-box").fadeTo(400,1,function(){e(this).bind("click",function(e){e.target===this&&s.removeReddeBox()})}),i.imageArray.length?(i.activeImage&&(this.activeIndex=i.activeImage),this.showImage(e(this.jQueryMatchedObj[this.activeIndex]))):this.showImage(e(t)),this.container.find("a").click(function(t){switch(this.className){case"redde-next":case"redde-prev":s.container.stop(!0,!0);var i="redde-prev"===this.className?-1:1;void 0!==s.jQueryMatchedObj[s.activeIndex+i]&&(s.activeIndex=s.activeIndex+i,s.showImage(e(s.jQueryMatchedObj[s.activeIndex])));break;case"redde-close":s.removeReddeBox()}t.preventDefault()})}}})(jQuery);